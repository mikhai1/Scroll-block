/* 
	Mikhail Sergeevich
	18.01.2016
	version 0.1
 */
!function(t){t.fn.scroll_block=function(){if(1==this.data("scroll_block")||void 0==this.html())return this;this.data("scroll_block",!0);var o,i,s,e,l,p,c=t(window),f=this,n=f.wrapInner('<div id="scroll_block_jquery" style="position:relative;display:block;width:100%;top:0;left:0;max-width:'+f.width()+'px"></div>').children("#scroll_block_jquery"),h=c.scrollTop(),r={},a={},d={t:function(){n.css({position:"relative",top:0,left:0})},b:function(){n.css({position:"relative",top:l+"px",left:0})}},u=function(){e=n.height()-c.height(),l=f.height()-n.height(),p=f.offset().left,a.top=f.offset().top,a.bottom=f.offset().top+l,e>0?(r.top=f.offset().top+n.height()-c.height(),r.bottom=f.offset().top+f.height()-c.height()):(r.top=f.offset().top,r.bottom=f.offset().top+f.height()-n.height()),d.f=function(){var t;e>0?(t=n.offset().top-c.scrollTop(),-e>t?t=-e:t>0&&(t=0)):t=0,n.css({position:"fixed",top:t+"px",left:p})}};return u(),t(document).on("scroll_edit",function(){u();var t=c.scrollTop()+c.height()-n.offset().top-n.height();if(e>0&&"relative"==n.css("position")&&t>0){var o=parseInt(n.css("top"));n.css("top",o+t),d.f()}}),c.resize(function(){u()}),c.scroll(function(){o=c.scrollTop(),i=parseInt(n.css("top")),s=o-h,s>0?o<=r.top?d.t():o>=r.bottom?d.b():"relative"==n.css("position")?d.f():e>0&&i>-e&&n.css("top",i-s>-e?i-s:-e):0>s&&(o<=a.top?d.t():o>=a.bottom?d.b():"relative"==n.css("position")?d.f():e>0&&0>i&&n.css("top",0>i-s?i-s:0)),h=c.scrollTop()}),this}}(jQuery);
